<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bettr Casino: Open Source Game Development Platform</title>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.24/css/jquery.dataTables.css">
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.js"></script>
    <script src="https://cmp.osano.com/Azyq2mU0Sb8gd7G6E/a5c3c18a-3383-4f4f-9ec7-2ecb3f239c09/osano.js"></script>
    <style>

        .header-buttons {
            text-align: right;
            padding: 10px;
            background-color: #002246; /* Optional: to match the header color */
        }

        .header-btn {
            color: white;
            background-color: #9a9af7;
            font-size: 16px; 
            border: none;
            border-radius: 5px;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }

        .header-btn:hover {
            background-color: #8484f8; /* Slightly lighter color on hover */
        }


        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji";
            background-color: #fff; /* Set background color if needed */
            color: #333; /* Set text color if needed */
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 8px;
        }

        th {
            background-color: #002246; /* Updated header background color */
            color: #fff; /* Set header text color to white for better contrast */
        }

        h1 {
            background-color: #002246; /* Updated to match the provided styling */
            color: #fff; /* Set text color to white for better contrast */
            padding: 0px; /* Adjust padding as needed */
            text-align: center; /* Center the title if needed */
        }

        /* Additional styling for DataTables elements as needed */
        .dataTables_wrapper .dataTables_paginate .paginate_button {
            background-color: #002246; /* Match button color to the theme */
            color: #fff;
            border: 1px solid #fff; /* Add white border for visibility */
        }
        
        .dataTables_wrapper .dataTables_paginate .paginate_button:hover {
            background-color: #002246; /* Maintain the same color on hover */
            border: 1px solid #aaa; /* Change border color on hover for differentiation */
        }

        .highlighted td {
            background-color: #9a9af7 !important; /* Adjust the color as needed */
        }

        #details-form {
            border: 1px solid #ddd; /* Border for the form box */
            padding: 5px; /* Padding inside the form */
            margin-top: 5px; /* Space above the form */
            background-color: #f9f9f9; /* Light background for the form */
            border-radius: 5px; /* Rounded corners for the form */
        }

        #details-form h3 {
            margin-top: 0; /* Align header to the top of the form */
            color: #002246; /* Color of the header */
        }

        #details-form p {
            font-size: 16px; /* Font size for form content */
            line-height: 1.5; /* Line height for better readability */
        }

        .details-table {
            width: 100%; /* Full width of the container */
            border-collapse: collapse; /* Collapsed borders */
        }

        .details-table td {
            padding: 5px; /* Padding in table cells */
            border: 1px solid #ddd; /* Border for each cell */
        }

        .details-table td:first-child {
            font-weight: bold; /* Bold font for keys */
            width: 30%; /* Fixed width for keys column */
        }

        .details-table td:last-child {
            width: 70%; /* Remaining width for values column */
        }

        .all-challenges-btn {
            background-color: #9a9af7; /* Same as highlighted row color */
            color: white; /* Text color */
            padding: 10px 20px; /* Padding for size */
            border: none; /* No border */
            border-radius: 5px; /* Rounded corners */
            font-size: 16px; /* Font size */
            cursor: pointer; /* Pointer cursor on hover */
            display: block; /* Block level element */
            margin: 20px; /* Center align */
            text-align: center; /* Center text */
            position: relative;
        }

        .challenge-spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid #0732f3;
            width: 8px;
            height: 8px;
            margin-left: 20px;
            animation: spin 2s linear infinite;
            display: inline-block;
            position: relative;
            right: 10px;
        }

        .tag {
            display: inline-block;
            background-color: #002246;
            color: white;
            padding: 5px 10px;
            margin: 2px;
            border-radius: 5px;
            font-size: 16px;
        }

        .code {
            letter-spacing: 5px;
        }


        /* modal */
        .modal {
            position: fixed; /* Keep it fixed relative to the viewport */
            z-index: 2; /* Higher z-index to ensure it's above other content */
            display: none; /* Initially hidden */
            background-color: rgba(0, 34, 70, 0.4); /* Semi-transparent background */
        }

        .modal-content {
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #002246;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            width: auto; /* Auto width based on content */
            min-width: 200px; /* Minimum width */
            max-width: 300px; /* Maximum width */
        }

        .close-btn {
            color: #002246; /* Close button color to match scheme */
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-btn:hover {
            color: #9a9af7; /* Color on hover */
        }

        .modal p {
            color: #333; /* Text color */
            font-size: 18px; /* Text size */
            text-align: center; /* Center the text */
        }

        .register-modal-content,
        .login-modal-content,
        .verification-modal-content {
            background-color: #f9f9f9;
            padding: 10px;
            border: 1px solid #002246;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            width: auto; /* Auto width based on content */
            min-width: 200px; /* Minimum width */
            max-width: 350px; /* Maximum width */
        }

        /* The Submit Button */
        #register_button,
        #login_button,
        #verification_button {
            background-color: #9a9af7; /* Same as highlighted row color */
            color: white; /* Text color */
            padding: 14px 20px;
            margin: 8px 0;
            border: none;
            cursor: pointer;
            width: 100%; /* Full width */
            border-radius: 5px; /* Rounded corners */
        }

        #register_button:hover,
        #login_button:hover,
        #verification_button {
            background-color: #8484f8; /* Slightly lighter color on hover */
            opacity: 0.9;
        }

        /* The Close Button */
        #register_close,
        #login_close,
        #verification_close {
            color: #002246; /* Color to match the header */
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        #register_close:hover,
        #register_close:focus,
        #login_close:hover,
        #login_close:focus, 
        #verification_close:hover,
        #verification_close:focus {
            color: #9a9af7; /* Color on hover to match the button */
            text-decoration: none;
            cursor: pointer;
        }        

        /* Style for the verification code input */
        #register-modal input[type="text"],
        #login-modal input[type="text"],
        #verification-modal input[type="text"] {
            width: calc(100% - 20px);
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd; /* Light grey border */
            border-radius: 5px;
            font-size: 14px;
        }

        /* Disabled state of the button */
        #register_button:disabled,
        #login_button:disabled,
        #verification_button:disabled {
            background-color: #cccccc; /* Light gray background to indicate it's disabled */
            color: #666666; /* Darker gray text */
            cursor: not-allowed; /* Cursor to indicate the button is not clickable */
            border: 1px solid #bbbbbb; /* Border color for disabled state */
        }

        /* Hover state of the disabled button to ensure there's no change */
        #register_button:disabled:hover,
        #login_button:disabled:hover,
        #verification_button:disabled:hover {
            background-color: #cccccc; /* Same as the normal disabled state */
            opacity: 1; /* No change in opacity */
        }
                
        /* Add the back button styles as well */
        .verification-modal-back-btn {
            display: inline-block;
            margin-top: 10px;
            color: #9a9af7;
            cursor: pointer;
            text-decoration: underline;
        }

        .verification-modal-back-btn:hover {
            color: #8484f8;
        }
        
        .button-with-spinner {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .button-status-container {
            display: block;
            position: relative;
            justify-content: left;
            align-items: left;
            padding: 0px;
        }

        .status-text {
            margin-left: 10px; /* Space between the button and status text */
            display: none; /* Initially hidden */
        }

        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid #0732f3;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            animation: spin 2s linear infinite;
            position: absolute;
            right: 10px;
        }

        .spinner2 {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 3px solid #0732f3;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            animation: spin 2s linear infinite;
            position: absolute;
        }

        .spinner3 {
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 5px solid #0732f3;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            animation: spin 2s linear infinite;
            position: absolute;
        }

        .spinner4 {
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top: 5px solid #0732f3;
            width: 20px;
            height: 20px;
            margin-left: 10px;
            animation: spin 2s linear infinite;
            position: absolute;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Style for the container that holds the two panels */
        #show-challenge-editor-form {
            display: flex; /* Use flexbox for layout */
            justify-content: space-between; /* Space out the children */
            padding-top: 10px; /* Add some padding */
        }

        /* Style for each panel */
        .panel {
            flex: 1; /* Each panel takes up an equal amount of space */
            margin-left: 5px; /* Add some margin between panels */
            margin-right: 5px; /* Add some margin between panels */
            padding-left: 5px; /* Add some padding inside each panel */
            padding-right: 5px; /* Add some padding inside each panel */
            border: 1px solid #ddd; /* Add a border to each panel */
            border-radius: 5px; /* Round the corners of the border */
            background-color: #f9f9f9; /* Light background color */
        }

        /* Style for iPhone containers */
        .iphone {
            /* Common iPhone styling */
            background-color: #000; /* Dark background to mimic screen off */
            border-radius: 25px; /* Rounded corners like an iPhone */
            border: 2px solid #333; /* Thin bezel effect */
            box-shadow: 0 0 10px rgba(0,0,0,0.5); /* Shadow for 3D effect */
            margin: 20px auto;
            display: none; /* Initially hidden */
        }

        .iphone img {
            width: 100%;
            height: 100%;
            object-fit: contain; /* Or 'cover' if that's the desired effect */
            border-radius: 25px; /* Match the container's border-radius */
        }

        /* Individual iPhone sizes */
        .iphone13 {
            width: 506px;
            height: 234px;
        }

        .iphone14 {
            width: 520px;
            height: 240px;
        }

        .iphone15 {
            width: 530px;
            height: 245px;
        }

        /* Styles for iPhones with Retina displays */
        @media only screen and (max-width: 430px) {

            .iphone13 {
                width: 354.2px; /* 506px * 0.7 */
                height: 163.8px; /* 234px * 0.7 */
            }

            .iphone14 {
                width: 364px; /* 520px * 0.7 */
                height: 168px; /* 240px * 0.7 */
            }

            .iphone15 {
                width: 371px; /* 530px * 0.7 */
                height: 171.5px; /* 245px * 0.7 */
            }

        }

        .scene-hierarchy-container {
            display: none; /* Align items in a row */
            justify-content: center; /* Center items horizontally */
            margin-top: 20px; /* Margin at the top */
            margin-bottom: 20px; /* Spacing before the iPhone displays */
            overflow: hidden; /* Ensure that no content spills outside */
        }

        .scene-hierarchy {
            width: 100%; /* Or adjust based on your layout needs */
            height: 234px; /* Or adjust based on your layout needs */
            overflow-y: auto; /* Enable vertical scrolling */
            padding: 10px; /* Optional: Adds some space inside the container */
            border: 1px solid #ddd; /* Optional: Adds a border around the container */
            border-radius: 5px; /* Optional: Rounds the corners of the container */
            background-color: #f9f9f9; /* Optional: Sets a background color */
        }

        /* Container for the iPhone buttons */
        .iphone-buttons-container {
            display: flex; /* Align items in a row */
            justify-content: center; /* Center items horizontally */
            margin-top: 20px; /* Margin at the top */
            margin-bottom: 20px; /* Spacing before the iPhone displays */
        }

        /* iPhone Toggle Button Style */
        .toggle-button {
            background-color: #ccc; /* Default color for inactive state */
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 10px; /* Space between buttons */
        }

        .toggle-button.active {
            background-color: #9a9af7; /* Highlight color for active state */
        }

        .toggle-button:hover {
            background-color: #8484f8;
        }

        #setup-btn {
            display: block;
        }

        #setup-div {
            width: 100%;
            height: 240px;
            padding: 5px 5px; /* Padding inside the div */
            margin-top: 10px; /* Margin at the top */
            text-align: center; /* Center content horizontally */
            box-sizing: border-box; /* To include padding in the width and height */
            background-color: #f9f9f9; /* Background color similar to the table */
            border: 1px solid #ddd; /* Border style similar to the table */
            border-radius: 5px; /* Rounded corners for the form */
            display: block;
            justify-content: center; /* Center horizontally */
            align-items: center; /* Center vertically */
        }

        .setup-step {
            /* other styles for setup steps */
            width: 100%;
            height: 100%;
            position: relative; /* This allows absolute positioning of children relative to this parent */
        }

        .setup-step-button {
            background-color: #9a9af7; /* Default color for inactive state */
            color: white; /* Text color */
            margin-top: 10px; /* Space between steps */
            padding: 10px 20px;
            border: none; /* No border */
            border-radius: 5px; /* Rounded corners */
            font-size: 16px; /* Font size */
            cursor: pointer; /* Pointer cursor on hover */
            position: relative; /* Absolute positioning within the setup-step */
        }

        /* Disabled state for the button */
        .setup-step-button:disabled {
            background-color: #cccccc; /* Light gray background for disabled state */
            color: #666666; /* Darker gray text */
            cursor: default; /* Default cursor to not suggest it's clickable */
            pointer-events: none; /* Prevents click and hover events */
        }

        .setup-step-button.active {
            background-color: #9a9af7; /* Highlight color for active state */
        }

        .setup-step-button:not(:disabled):hover {
            background-color: #8484f8;
        }

        .code-container {
            display: flex;
            justify-content: space-between;
            max-width: 300px; /* Adjust the width as needed */
            margin: auto;
        }

        .code-container input[type="text"] {
            border: 2px solid #cccccc;
            border-radius: 1px;
            padding: 4px 4px;
            text-align: center;
            width: 20px;
            height: 20px;
            margin: 0px;
            font-size: 16px;
        }

        /* Style to remove spinner arrows from input type number */
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type='number'] {
            -moz-appearance: textfield; /* Firefox */
        }

        #StartAppCode {
            letter-spacing: 5px;
        }

        .tabs {
            overflow: hidden;
            background: #002246; /* Background color for the tab bar */
            padding: 0 10px; /* Padding on the sides of the tab bar */
        }

        .tab-button {
            background-color: #fff;
            color: #333;
            float: left;
            border: none;
            outline: none;
            cursor: pointer;
            padding: 10px 20px;
            transition: background-color 0.3s;
            border-radius: 0; /* Remove the border-radius for a more 'tab-like' appearance */
            margin-bottom: -1px; /* Overlap the content below */
            position: relative; /* Needed for z-index */
            z-index: 1; /* Place the tabs above the content border */
        }

        .tab-button:not(:disabled):hover {
            background-color: #ddd;
        }

        .tab-button.active {
            background-color: #9a9af7; /* Set the background color for the active tab */
            color: white; /* Set the text color for the active tab to white */
            border-bottom: 2px solid #9a9af7; /* Match the border color with the active tab's background */
            /* Remove the right border for active tab if desired */
            border-right: none;
        }

        .tab-content {
            border: 1px solid #ddd;
            padding: 10px;
            background: #fff;
        }

        /* Clearfix for floated tab buttons */
        .tabs:after {
            content: "";
            display: table;
            clear: both;
        }

        #SetupWizardRequirements {
            display: flex; /* Use Flexbox */
            flex-direction: column; /* Stack children vertically */
            align-items: center; /* Center children horizontally */
            justify-content: center; /* Center children vertically if there's height specified */
            gap: 10px; /* Optional: adds some space between the tags */
        }

    </style>
</head>
<body>

    <!-- Modal Structure -->
    <div id="user-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <p id="modal-message"></p>
        </div>
    </div>

    <!-- The Register Modal -->
    <div id="register-modal" class="modal" style="display: none;">
        <!-- Modal content -->
        <div class="register-modal-content">
            <span id="register_close" class="close">&times;</span>
            <h2>Register</h2>
            <p>We’ll email you a verification code.</p>
            <form id="register-form">
                <input id="register-modal-input" type="email" placeholder="Email" name="email" required>
                <label>
                    <input type="checkbox" checked="checked" name="remember"> Remember me
                </label>
                <button id="register_button" type="button" class="button-with-spinner">
                    Get verification code
                    <div id="register-spinner" class="spinner" style="display: none;"></div>
                </button>
                <!-- Error message -->
                <p id="register-error" style="display: none; color: red;"></p>
            </form>
        </div>
    </div>

    <!-- The Login Modal similar to the Register Modal -->
    <div id="login-modal" class="modal" style="display: none;">
        <!-- Modal content -->
        <div class="login-modal-content">
            <span id="login_close" class="close">&times;</span>
            <h2>Login</h2>
            <p>We’ll email you a verification code.</p>
            <form id="login-form">
                <input id="login-modal-input" type="email" placeholder="Email" name="email" required>
                <label>
                <input type="checkbox" checked="checked" name="remember"> Remember me
                </label>
                <button id="login_button" type="button" class="button-with-spinner">
                    Get verification code
                    <div id="login-spinner" class="spinner" style="display: none;"></div>
                </button>
                <!-- Error message -->
                <p id="login-error" style="display: none; color: red;"></p>
            </form>
        </div>
    </div>

    <!-- The Verification Modal -->
    <div id="verification-modal" class="modal" style="display: none;">
        <!-- Modal content -->
        <div class="verification-modal-content">
            <span id="verification_close" class="close">&times;</span>
            <span id="verification_back" class="verification-modal-back-btn">Back</span>
            <h2>Verification</h2>
            <p>We emailed you a verification code.</p>
            <form id="verification-form">
                <input id="verification-modal-input" type="text" placeholder="Enter Verification Code" name="verification_code" required>
                <button id="verification_button" type="button" class="button-with-spinner">
                    Verify
                    <div id="verification-spinner" class="spinner" style="display: none;"></div>
                </button>
                <!-- Error message -->
                <p id="verification-error" style="display: none; color: red;"></p>
            </form>
        </div>
    </div>

    <div class="header-buttons section1">
        <h1>Bettr Casino: Open Source Game Development Platform</h1>
        <button id="register-btn" class="header-btn" style="display: none;">Register</button>
        <button id="login-btn" class="header-btn" style="display: none;">Login</button>
        <button id="logout-btn" class="header-btn" style="display: none;">Logout</button>
    </div>

    <div class="content section1">
            
        <h2>Open Source Game Development Platform</h2>
        <p>Bettr Casino is an open source game development platform... yawn... blah blah blah... Our mission is to build and deploy online games through &lt;<strong>insert corporate speak here</strong>&gt; ... snore... zzzz... Oh, excuse me! I must have nodded off. Is the room still spinning?</p>
        <p>Hey, you! Yes, you, reading this. Do you like games? Do you like open source projects? Do you like challenges? Well, do we have a treat for you!</p>
        <p>Join us by solving the most mind-bending, hair-pulling real world challenges in the gaming industry! Well, not really ... most will be easy. Just trust us bro! </p>

        <!-- Additional Content Sections Here -->

    </div>        

    <!-- Summary Table -->
    <table id="summary-table" class="display section1" width="100%">
        <thead>
            <!-- Headers will be dynamically populated -->
        </thead>
        <tbody>
            <!-- Rows will be dynamically populated -->
        </tbody>
    </table>

    <!-- Details Form -->
    <div id="details-form" class="section2" style="display: none;">
        <!-- Dynamic form fields will be populated here -->
    </div>

    <script>
        // Create a constant for the prefix
        const prefix = 'BETTR__';

        function prefix_local_store(local_store_value) {
            return `${prefix}${local_store_value}`
        }

        $(document).ready(function() {  
            
            class ObserverManager {
                constructor() {
                    this.observers = [];
                }

                subscribe(observerFunction) {
                    this.observers.push(observerFunction);
                }

                unsubscribe(observerFunction) {
                    this.observers = this.observers.filter(subscriber => subscriber !== observerFunction);
                }

                notify(data) {
                    this.observers.forEach(observerFunction => observerFunction(data));
                }
            }

            const authObserverManager = new ObserverManager();

            const dataUrl = 'https://bettr-casino-tasks.s3.us-west-2.amazonaws.com/gsheets-task-list/allopentasks.json';
    
            // Fetch and process data
            fetch(dataUrl)
                .then(response => response.json())
                .then(data => {
                    setupTables(data);
                });

            const wizardShouldShowFunctions = {
                "RegisterUser": function(stepKey, taskId, rowIndex) {
                    return !isUserLoggedIn();
                }
            }

            const wizardOnShowFunctions = {
                "SetupIPhone": function(stepKey, taskId, rowIndex) {
                    $('.back-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', false);
                    $('.finish-btn').prop('disabled', true);
                },
                "RegisterUser": function(stepKey, taskId, rowIndex) {
                    $('.finish-btn').prop('disabled', true);
                    if (isUserLoggedIn()) {
                        $('#RegisterUserText').text('You are logged in. Click Next.');
                        $('#RegisterUserAction').hide();
                        $('#RegisterUserAction').text('Login');
                        $('#RegisterUserTitle').text('Login.');
                        $('.next-btn').prop('disabled', false);
                        return;
                    } 
                    if (isUserRegistered()) {
                        $('#RegisterUserAction').text('Login');
                        $('#RegisterUserTitle').text('Login.');
                    }
                },
                "VerifySetup": function(stepKey, taskId, rowIndex) {
                    $('.back-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', true);
                    $('.finish-btn').prop('disabled', true);
                    $(`#verify-setup-spinner`).show();
                },
                "StartApp": function(stepKey, taskId, rowIndex) {
                    $('.next-btn').prop('disabled', true);
                    $('.finish-btn').prop('disabled', true);
                    $('#GenerateChallengeCodeText').text("______");
                    $(`.GenerateChallengeCodeInfoStep1`).show();
                    $(`.GenerateChallengeCodeInfoStep2`).hide();
                    $(`.GenerateChallengeCodeInfoStep3`).hide();
                },
                "VerifyApp": function(stepKey, taskId, rowIndex) {
                    $('.back-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', true);
                    $('.finish-btn').prop('disabled', true);
                },
                "SetupUnity": function(stepKey, taskId, rowIndex) {
                    $('.back-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', false);
                    $('.finish-btn').prop('disabled', true);
                },
                "VerifyUnitySetup": function(stepKey, taskId, rowIndex) {
                    $('.back-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', true);
                    $('.finish-btn').prop('disabled', true);
                    $(`#verify-unity-setup-spinner`).show();
                },
            }

            const wizardAfterShowFunctions = {
                "RegisterUser": function(evt, stepKey, taskId, rowIndex) {
                    $('.finish-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', false);
                    if (!isUserLoggedIn()) {
                        $('.next-btn').prop('disabled', true);
                    }
                },
                "VerifySetup": function(stepKey, taskId, rowIndex) {
                    $('.back-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', true);
                    $('.finish-btn').prop('disabled', true);
                    $('#VerifySetupChallengeCode').hide();
                    var taskState = "VERIFY_SETUP"
                    var verifySetupInfo = $('#VerifySetupInfo');
                    initiateVerifySetupCountdown(59);
                    initializeDeveloperAccount(taskId, taskState, function(response, error) {
                        if (error) {
                            $(`#verify-setup-spinner`).hide();
                            $('.next-btn').prop('disabled', false);
                            $('#VerifySetupInfo').empty().text("Setup incomplete. Click Next.")
                        } else {
                            var hashKey = response.task_hash_key;
                            if (hashKey && hashKey.length == 6) {
                                localStorage.setItem(prefix_local_store(`TASK_ID__${taskId}__hash_key`), hashKey);
                                const objectKey = `developers/${hashKey}/scene_state/image.png`;
                                verifyAppInstall(objectKey, 0, function(err) {
                                    $(`#verify-setup-spinner`).hide();
                                    if (err) {
                                        console.error('VerifySetup verifyAppInstall Error:', err);
                                        $('.next-btn').prop('disabled', false);
                                        $('#VerifySetupInfo').empty().text("Click Next.");
                                    } else {
                                        $('.next-btn').prop('disabled', false);
                                        $('#setupCountdownTimer').hide()
                                        $('#VerifySetupInfo').empty().text("Bettr App Setup is complete. Click Next.");
                                        $("#VerifySetupChallengeCode .tag.code").text(hashKey);
                                        // $('#VerifySetupChallengeCode').show();
                                        var nextStepIndex = 5;
                                        localStorage.setItem(stepKey, `${nextStepIndex}`);
                                    }
                                })                
                            }
                        }
                    })
                },
                "StartApp": function(stepKey, taskId, rowIndex) {
                    $('.back-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', true); 
                    $('.finish-btn').prop('disabled', true);              
                    $(`#start-app-spinner`).show();
                    var generateChallengeCodeText = $('#GenerateChallengeCodeText');
                    var taskState = "GENERATE_CODE"
                    initializeDeveloperAccount(taskId, taskState, function(response, error) {
                        $(`#start-app-spinner`).hide();
                        if (error) {
                            console.log(error);
                            showModalPanel(generateChallengeCodeText, 'Code Generation error. Support email: support@bettr.casino.', 'center');
                        } else {
                            // Access the properties from the parsed body
                            var hashKey = response.task_hash_key;
                            if (hashKey && hashKey.length == 6) {
                                $('#GenerateChallengeCodeText').text(hashKey);
                                localStorage.setItem(prefix_local_store(`TASK_ID__${taskId}__hash_key`), hashKey);
                                const objectKey = `developers/${hashKey}/scene_state/image.png`;
                                verifyAppInstall(objectKey, 0, function(err) {
                                    $(`.GenerateChallengeCodeInfoStep1`).hide();
                                    if (err) {
                                        console.error('StartApp verifyAppInstall Error:', err);
                                        $('.next-btn').prop('disabled', false);
                                        $(`.GenerateChallengeCodeInfoStep2`).show();
                                    } else {
                                        $(`.GenerateChallengeCodeInfoStep3`).show();
                                        $('.finish-btn').prop('disabled', false);
                                    }
                                })
                            } else {
                                console.log(`incorrect hash_key (length != 6) in response body=${JSON.stringify(response)}`);
                                showModalPanel(generateChallengeCodeText, 'Code Generation error. Go Back and retry. Support email: support@bettr.casino.', 'center');
                            }
                        }
                    })
                },
                "VerifyApp": function(stepKey, taskId, rowIndex) {
                    $('#VerifyAppResult').empty().append('Wait until the verify completes.');
                    $('.back-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', true);
                    $('.finish-btn').prop('disabled', true);
                    $(`#verify-app-spinner`).show();
                    const hashKey = localStorage.getItem(prefix_local_store(`TASK_ID__${taskId}__hash_key`));
                    $("#VerifyAppChallengeCode .tag.code").text(hashKey);
                    // $("#VerifyAppChallengeCode").show();
                    activeIPhoneContainer().empty();
                    const localStorageKey = prefix_local_store(`TASK_ID__${taskId}__screenshot_request_time`);
                    const currentUtcTimestamp = Math.floor(Date.now() / 1000);
                    localStorage.setItem(localStorageKey, currentUtcTimestamp);
                    const callback = function(err) {
                        if (err) {
                            console.error('Error:', err);
                            $('#VerifyAppResult').empty().append($(`<span style="color: red;">${err.message}</span>`));
                            $(`#verify-app-spinner`).hide();
                            $('#countdownTimer').hide()
                            $('.back-btn').prop('disabled', false);
                            $('.next-btn').prop('disabled', true);
                            $('.finish-btn').prop('disabled', true);
                        } else {
                            $('#VerifyAppInfo').empty().text("Bettr App Installation verified. Click Next.")
                            $('#VerifyAppResult').empty();
                            $(`#verify-app-spinner`).hide();
                            $('#countdownTimer').hide()
                            $('.next-btn').prop('disabled', true);
                            $('.finish-btn').prop('disabled', false);
                        }
                    }
                    initiateVerifyAppCountdown(59);
                    const objectKey = `developers/${hashKey}/scene_state/image.png`;
                    verifyAppInstall(objectKey, 20, callback);
                },
                "VerifyUnitySetup": function(stepKey, taskId, rowIndex) {
                    $('.back-btn').prop('disabled', true);
                    $('.next-btn').prop('disabled', true);
                    $('.finish-btn').prop('disabled', true);
                    $('#VerifyUnitySetupChallengeCode').hide();
                    var taskState = "VERIFY_SETUP"
                    var verifySetupInfo = $('#VerifyUnitySetupInfo');
                    initiateVerifyUnitySetupCountdown(59); 
                    initializeDeveloperAccount(taskId, taskState, function(response, error) {
                        if (error) {
                            $(`#verify-setup-spinner`).hide();
                            $('.next-btn').prop('disabled', false);
                            $('#VerifySetupInfo').empty().text("Setup incomplete. Click Next.")
                        } else {
                            var hashKey = response.task_hash_key;
                            if (hashKey && hashKey.length == 6) {
                                localStorage.setItem(prefix_local_store(`TASK_ID__${taskId}__hash_key`), hashKey);
                                const objectKey = `developers/${hashKey}/unity_state/image.png`;
                                verifyAppInstall(objectKey, 0, function(response, err) {
                                    console.log(`response:${response} err=${err}`);
                                    $(`#verify-unity-setup-spinner`).hide();
                                    if (err) {
                                        console.error('VerifyUnitySetup Error:', err);
                                        $('.next-btn').prop('disabled', false);
                                        $('#VerifyUnitySetupInfo').empty().text("Bettr Unity Setup is not complete. Click Next.");
                                    } else {
                                        $('.next-btn').prop('disabled', false);
                                        $('#unitySetupCountdownTimer').hide()
                                        $('#VerifyUnitySetupInfo').empty().text("Bettr Unity Setup is complete. Click Next.");
                                        $("#VerifyUnitySetupChallengeCode .tag.code").text(hashKey);  
                                    }
                                })                
                            }
                        }
                    })
                }
            }

            const wizardOnClickFunctions = {
                "RegisterUser": function(evt, stepKey, taskId, rowIndex) {
                    evt.preventDefault();  // Prevents the default link action
                    authObserverManager.subscribe(function() {
                        wizardOnShowFunctions["RegisterUser"]();
                    });
                    if (isUserRegistered()) {
                        showLoginPanel(evt.target, "center");
                    } else {
                        showRegisterPanel(evt.target, "center");
                    }
                },
                "StartApp": function(evt, stepKey, taskId, rowIndex) {
                    evt.preventDefault();  // Prevents the default link action                    
                }
            }

            const wizardOnBackFunctions = {
                "StartApp": function(stepKey, taskId, rowIndex) {
                    if (isUserLoggedIn()) {
                        $('.setup-step').hide();
                        $('#Start').show();
                        localStorage.removeItem(stepKey);
                        return false;
                    }                    
                    return true;
                }
            }

            const wizardOnNextFunctions = {
                "RegisterUser": function(stepKey, taskId, rowIndex) {
                    if (isUserLoggedIn()) {
                        return true;
                    }
                    var registerUserA = $('#RegisterUserAction');
                    showModalPanel(registerUserA, 'Complete this step to continue.', 'center');
                    return false;
                },
                "StartApp": function(stepKey, taskId, rowIndex) {
                    if (isTaskHashKeyGenerated(taskId)) {
                        return true;
                    }
                    return false;
                }
            }

            function wizardOnFinishFunction(taskId, rowIndex) {
                $('.setup-step-button').hide(); 
                $('.setup-step').hide(); 
                $('#StartChallenge').show(); 
                $('.show-challenge-btn').hide();
                $('.start-challenge-btn').show();

                $('#TestTabButton').show();
                $('#SubmitTabButton').show();

                $('#TestTabButton').removeAttr("disabled");
                $('#SubmitTabButton').removeAttr("disabled");

                const hashKey = localStorage.getItem(prefix_local_store(`TASK_ID__${taskId}__hash_key`));

                $("#StartChallengeCode .tag.code").text(hashKey);
                $('#StartChallengeCode').show();

                const objectKey = `developers/${hashKey}/scene_state/hierarchy.json`;
                const $sceneHierarchyContainer = $('.scene-hierarchy-container');
                const $sceneHierarchy = $('.scene-hierarchy-container .scene-hierarchy');

                getState(objectKey, function(response, status, error) {
                    if (error == null) {
                        if (response.file_data) {
                            var jsonData = atob(response.file_data);
                            const jsonObject = JSON.parse(jsonData);
                            jsonData = JSON.stringify(jsonObject, null, 2); // Indent with 2 spaces
                            console.log('jsonData:', jsonData);
                            $sceneHierarchy.empty().append($("<pre>").text(jsonData));
                            $sceneHierarchyContainer.show();
                        }
                    } else {
                        console.error("Error in invoking Lambda:", error);
                    }
                });

                return true;
            }

            function activeIPhoneContainer() {
                if (!$('#toggle-iphone13').prop('disabled')) return $('#iphone13');
                if (!$('#toggle-iphone14').prop('disabled')) return $('#iphone14');
                if (!$('#toggle-iphone15').prop('disabled')) return $('#iphone15');
                return null;
            }

            // Function to validate email using simple regex
            function isValidEmail(email) {
                var regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return regex.test(email);
            }            

            function updateSignInButtons() {
                validateSessionToken(function(err, response) {
                    if (err) {
                        console.error('Error:', err);
                        $('#register-btn').show();
                        $('#login-btn').show();
                        $('#logout-btn').hide();
                    } else {
                        $('#register-btn').hide();
                        $('#login-btn').hide();
                        $('#logout-btn').show();
                    }
                });
            }

            // Function to enable/disable verification button based on email validity
            function toggleVerificationButton(inputSelector, buttonSelector) {
                var email = $(inputSelector).val();
                if (isValidEmail(email)) {
                    $(buttonSelector).prop('disabled', false);
                } else {
                    $(buttonSelector).prop('disabled', true);
                }
            }

            function setupTables(data) {

                // Assuming the first row contains headers
                var headers = data.headers;
                var rows = data.rows;

                // Find the index of the "Publish" column
                const publishIndex = headers.indexOf("Publish");

                // Find indices for the 'Summary', 'Details', and 'Internal' columns
                const summaryStartIndex = headers.indexOf("Section");
                const detailsStartIndex = headers.indexOf("Section", summaryStartIndex + 1);
                const setupStartIndex = headers.indexOf("Section", detailsStartIndex + 1);
                const testStartIndex = headers.indexOf("Section", setupStartIndex + 1);
                const internalStartIndex = headers.indexOf("Section", testStartIndex + 1);
    
                // Create column definitions for Summary and Internal tables
                const summaryColumns = headers.slice(summaryStartIndex + 1, detailsStartIndex)
                    .map(header => ({ title: header }));
                const detailsColumns = headers.slice(detailsStartIndex + 1, setupStartIndex)
                    .map(header => ({ title: header }));
                const setupColumns = headers.slice(setupStartIndex + 1, testStartIndex)
                    .map(header => ({ title: header }));
                const testColumns = headers.slice(testStartIndex + 1, internalStartIndex)
                .map(header => ({ title: header }));
    
                // // Initialize the Summary DataTable
                const summaryTable = $('#summary-table').DataTable({
                    data: rows.map(row => row.slice(summaryStartIndex + 1, detailsStartIndex)), // Extract Summary columns
                    columns: summaryColumns,
                    pageLength: 5,  // Default number of rows per page
                    lengthMenu: [5, 10, 20, 50]
                });

                $(summaryTable.table().container()).addClass('section1');

                // Event listener for row click in Summary table
                $('#summary-table tbody').on('click', 'tr', function() {

                    // Remove highlighting from all rows
                    $('#summary-table tbody tr').removeClass('highlighted');
                
                    // Highlight the clicked row
                    $(this).addClass('highlighted');

                    const table = $('#summary-table').DataTable();
                    const rowIndex = table.row(this).index(); // Gets the index of the clicked row
                    const detailsRowData = rows.map(row => row.slice(detailsStartIndex + 1, setupStartIndex)); // Extract Details columns
                    const detailsRow = detailsRowData[rowIndex];
                    const taskIdIndex = detailsColumns.findIndex(column => column.title === 'ID');
                    const taskId = detailsRow[taskIdIndex];
                    const stepKey = `${prefix}TaskID__${taskId}__SetupIndex`;

                    function showNextWizardStep(rowIndex, offset) {
                        const setupRowData = rows.map(row => row.slice(setupStartIndex + 1, testStartIndex)); // Extract Setup columns
                        const setupRow = setupRowData[rowIndex];
                        const totalSteps = setupRow[0];
                        const completedSetupIndex = parseInt(localStorage.getItem(stepKey), 10) || 0;
                        const nextStepIndex = completedSetupIndex + offset;
                        if (nextStepIndex <= totalSteps) {
                            var stepIndex = setupColumns.findIndex(column => column.title === `Step${nextStepIndex}`);
                            const stepText = setupRow[stepIndex];
                            $('.setup-step').hide();
                            $('.setup-step-button').prop('disabled', true);
                            localStorage.setItem(stepKey, `${nextStepIndex}`);
                            const stepShouldShowFn = wizardShouldShowFunctions[stepText];
                            if (stepShouldShowFn) {
                                if (!stepShouldShowFn(stepKey, taskId, rowIndex)) {
                                    // skip further processing for this step
                                    showNextWizardStep(rowIndex, 1);
                                    return;
                                }
                            }
                            const stepOnShowFn = wizardOnShowFunctions[stepText];
                            if (stepOnShowFn) {
                                stepOnShowFn(stepKey, taskId, rowIndex);
                            }
                            const stepOnClickFn = wizardOnClickFunctions[stepText];
                            if (stepOnClickFn) {
                                $(`#${stepText}Action`).off('click').on('click', function(evt) { stepOnClickFn(evt, stepKey, taskId, rowIndex); });
                            }
                            $(`#${stepText}`).show();
                            $('.back-btn').off('click').on('click', function() {
                                const stepOnBackFn = wizardOnBackFunctions[stepText];
                                if (stepOnBackFn) {
                                    if (!stepOnBackFn(stepKey, taskId, rowIndex)) {
                                        return;
                                    }
                                }
                                showNextWizardStep(rowIndex, -1);
                            });
                            $('.finish-btn').off('click').on('click', function() {
                                if (wizardOnFinishFunction(taskId, rowIndex)) {
                                    return;
                                }
                            });
                            $('.next-btn').off('click').on('click', function() {
                                const stepOnNextFn = wizardOnNextFunctions[stepText];
                                if (stepOnNextFn) {
                                    if (!stepOnNextFn(stepKey, taskId, rowIndex)) {
                                        return;
                                    }
                                }
                                showNextWizardStep(rowIndex, 1);
                            });
                            const stepAfterShowFn = wizardAfterShowFunctions[stepText];
                            if (stepAfterShowFn) {
                                stepAfterShowFn(stepKey, taskId, rowIndex);
                            }
                        }
                    }

                    populateDetailsForm(detailsColumns, detailsRow, rowIndex, function(rowIndex) {
                        localStorage.removeItem(stepKey);
                        showNextWizardStep(rowIndex, 1);
                    });
                });

                // Check if there are rows in the table
                if (summaryTable.data().any()) {
                    // Trigger click on the first row
                    $('#summary-table tbody tr:eq(0)').click();
                }    

            }


            function populateDetailsForm(columns, dataRow, rowIndex, callback) {
                const detailsForm = $('#details-form');
                // Clear existing content
                detailsForm.empty();

                var tabsHTML = `
                    <div id="SetupTab" class="tab-content" style="display:block;">
                        <!-- Your existing Setup content here -->
                    </div>
                    <div id="TestTab" class="tab-content" style="display:none;">
                        <!-- Content for Test -->
                    </div>
                    <div id="SubmitTab" class="tab-content" style="display:none;">
                        <!-- Content for Submit -->
                    </div>
                `;

                // Append the tabs HTML to the detailsForm
                detailsForm.append(tabsHTML);

                $setupTab = $('#SetupTab')

                // Start the table
                const detailsTable = $('<table>').addClass('details-table');

                    // Append the table to the form
                $setupTab.append(detailsTable);

                var setupDiv = `
                <div id="setup-div" class="setup">

                    <div class="setup-step" id="SetupIPhone" style="display: none;">
                        <h3>Setup Bettr App.</h3>
                        <p>Install the BettrApp on an iPhone 13+.</p>
                        <p>Click Next to get started.</p>
                    </div>

                    <div class="setup-step" id="RegisterUser" style="display: none;">
                        <h3 id="RegisterUserTitle">Register.</h3>
                        <p id="RegisterUserText">We do not store email ids. Read our <a href="https://bettr.casino/privacy.html">Privacy</a> policy.</p>
                        <button id="RegisterUserAction" class="header-btn">Register</button>
                    </div>

                    <div class="setup-step" id="StartSetup" style="display: none;">
                        <h3>Install BettrApp on iPhone13+.</h3>
                        <p>Open a browser tab on your iPhone 13+ device.</p>
                        <p>Type in the link below in your browser web address.</p>
                        <a href="https://testflight.apple.com/join/6japRuf7" target="_blank">testflight.apple.com/join/6japRuf7</a>                                                
                        <p>Follow the instructions on the web page to install the BettrApp on your iPhone 13+.</p>
                    </div>

                    <div class="setup-step" id="VerifySetup" style="display: none;">
                        <h3>Verifying Bettr App Setup.</h3>
                        <p id="VerifySetupInfo">Running verify. <input type="text" id="setupCountdownTimer" readonly style="width: 30px; text-align: center;"/><span id="verify-setup-spinner" class="spinner2" style="display: none;"></span></p>
                        <p id="VerifySetupChallengeCode" style="display: none">Challenge Code: <span class="tag code" style="font-size: 18px;"></span></p>
                    </div>

                    <div class="setup-step" id="StartApp" style="display: none;">
                        <h3>Configure <span id="ChallengeId">BettrApp Challenge</span>.</h3>
                        <p class="GenerateChallengeCodeInfoStep1">Generating Challenge Code ... <span id="start-app-spinner" class="spinner2" style="display: none;"></span></p>
                        <p><span id="GenerateChallengeCodeText" class="tag code" style="font-size: 18px;"></span></p>
                        <p class="GenerateChallengeCodeInfoStep2" style="display: none;">Launch the Bettr App on the iPhone 13+ device.</p>
                        <p class="GenerateChallengeCodeInfoStep2" style="display: none;">Type in the Bettr Challenge Code above in the App and press Continue.<span id="start-app-spinner" class="spinner2" style="display: none;"></span></p>
                        <p class="GenerateChallengeCodeInfoStep3" style="display: none;">Verify complete. <span>Click Finish.</span></p>
                    </div>

                    <div class="setup-step" id="VerifyApp" style="display: none;">
                        <h3>Verifying Bettr App Installation.</h3>
                        <p id="VerifyAppInfo">Running verify. <input type="text" id="countdownTimer" readonly style="width: 30px; text-align: center;"/><span id="verify-app-spinner" class="spinner2" style="display: none;"></span></p>
                        <p id="VerifyAppResult">Wait until the verify completes.</p>
                        <p id="VerifyAppChallengeCode" style="display: none">Challenge Code: <span class="tag code" style="font-size: 18px;"></span></p>
                    </div>

                    <div class="setup-step" id="SetupUnity" style="display: none;">
                        <h3>Setup Bettr Unity Package.</h3>
                        <p>Install Bettr Unity Package.</p>
                        <p><span class="tag">macOS Mojave</span> <span class="tag">macOS BigSur</span> <span class="tag">Windows 10</span> <span class="tag">Windows 11</span></p>
                        <p>Click Next to get started.</p>
                    </div>

                    <div class="setup-step" id="VerifyUnitySetup" style="display: none;">
                        <h3>Verifying Bettr Unity Setup.</h3>
                        <p id="VerifyUnitySetupInfo">Running verify. <input type="text" id="unitySetupCountdownTimer" readonly style="width: 30px; text-align: center;"/><span id="verify-unity-setup-spinner" class="spinner2" style="display: none;"></span></p>
                        <p id="VerifyUnitySetupChallengeCode" style="display: none">Challenge Code: <span class="tag code" style="font-size: 18px;"></span></p>
                    </div>

                    <div class="setup-step" id="StartUnityApp" style="display: none;">
                        <h3>Configure <span id="UnityChallengeId">Bettr Unity</span>.</h3>
                        <p class="UnityGenerateChallengeCodeInfoStep1">Generating Bettr Unity Challenge Package ... <span id="start-unity-app-spinner" class="spinner2" style="display: none;"></span></p>
                        <p class="UnityGenerateChallengeCodeInfoStep2" style="display: none;">Open Bettr Unity Project on your Mac or Windows.</p>
                        <p class="UnityGenerateChallengeCodeInfoStep2" style="display: none;">Type in the Bettr Challenge Code above in the App and press Continue.<span id="start-unity-app-spinner" class="spinner2" style="display: none;"></span></p>
                        <p class="UnityGenerateChallengeCodeInfoStep3" style="display: none;">Verify complete. <span>Click Finish.</span></p>
                    </div>

                    <div class="setup-step" id="VerifyUnityApp" style="display: none;">
                        <h3>Verifying Bettr Unity Installation.</h3>
                        <p id="VerifyUnityAppInfo">Running verify. <input type="text" id="unityAppc=CountdownTimer" readonly style="width: 30px; text-align: center;"/><span id="verify-unity-app-spinner" class="spinner2" style="display: none;"></span></p>
                        <p id="VerifyUnityAppResult">Wait until the verify completes.</p>
                        <p id="VerifyUnityAppChallengeCode" style="display: none">Challenge Code: <span class="tag code" style="font-size: 18px;"></span></p>
                    </div>

                    <div class="setup-step" id="InstallUnity" style="display: none;">
                        <h3>Install Unity.</h3>
                        <p>Click on the link below to install Unity 2022.3.16f1 via the Unity Hub.</p>
                        <p><a href="unityhub://2022.3.16f1/d2c21f0ef2f1" target="_blank">unityhub://2022.3.16f1/d2c21f0ef2f1</a></p>
                    </div>

                    <div class="setup-step" id="StartChallenge" style="display: none;">
                        <h3>Start Challenge.</h3>
                        <p id="StartChallengeCode" style="display: none">Challenge Code: <span class="tag code" style="font-size: 18px;"></span></p>
                    </div>
                </div>

                <div id="setup-btn" class="setup">
                    <button class="setup-step-button back-btn">Back</button>
                    <button class="setup-step-button next-btn">Next</button>
                    <button class="setup-step-button finish-btn">Finish</button>
                </div>

                <div class="scene-hierarchy-container">
                    <div id="scene-hierarchy" class="scene-hierarchy"></div>
                </div>

                <div class="iphone-buttons-container">
                    <button id="toggle-iphone13" class="toggle-button">iPhone 13</button>
                    <button id="toggle-iphone14" class="toggle-button">iPhone 14</button>
                    <button id="toggle-iphone15" class="toggle-button">iPhone 15</button>
                </div>

                <div id="iphone13-container">
                    <div id="iphone13" class="iphone iphone13"></div>
                </div>

                <div id="iphone14-container">
                    <div id="iphone14" class="iphone iphone14"></div>
                </div>

                <div id="iphone15-container">
                    <div id="iphone15" class="iphone iphone15"></div>
                </div>`

                $setupTab.append(setupDiv);

                // Iterate over columns and add rows to the table
                columns.forEach((column, index) => {
                    const columnName = column.title;  // Assuming column object has a 'title' property
                    const columnValue = dataRow[index];

                    // Check if the column is 'Tags' and process accordingly
                    
                    if (columnName === 'System Requirements') {
                        // Split the 'System Requirements' value into tags and display as text
                        const tags = columnValue.split(',').map(tag => tag.trim());
                        const $requirements = $('#SetupWizardRequirements');
                        $requirements.empty().text('Setup requires:')
                        tags.forEach(tag => {
                            const orTags = tag.split('or').map(t => t.trim());
                            const $tagContainer = $('<span>').addClass('tag-container');
                            orTags.forEach((orTag, i) => {
                                if (i > 0) {
                                    $tagContainer.append(document.createTextNode(' OR '));
                                }
                                $tagContainer.append($('<span>').addClass('tag').text(orTag));
                            });
                            $requirements.append($tagContainer);
                        });
                    } else if (columnName === 'Tags' || columnName === 'Skill Sets' || columnName == 'Setup Requirements') {
                        const tags = columnValue.split(',').map(tag => tag.trim());
                        const tagsContainer = $('<td>');
                        tags.forEach(tag => {
                            $('<span>').addClass('tag').text(tag).appendTo(tagsContainer);
                        });
                        const row = $('<tr>').append($('<td>').text(columnName)).append(tagsContainer);
                        detailsTable.append(row);
                    } else if (columnName === 'Difficulty') {
                        // Color-coded tags for Difficulty
                        const difficultySpan = $('<span>').addClass('tag').text(columnValue);
                        switch (columnValue.toUpperCase()) {
                            case 'EASY':
                                difficultySpan.css('background-color', 'green');
                                break;
                            case 'MEDIUM':
                                difficultySpan.css('background-color', 'yellow');
                                break;
                            case 'HARD':
                                difficultySpan.css('background-color', 'red');
                                break;
                        }
                        const row = $('<tr>').append($('<td>').text(columnName)).append($('<td>').append(difficultySpan));
                        detailsTable.append(row);
                    } else if (columnName === 'Timer') {
                        // Assuming columnValue is in fractional hours, convert to HH:MM:SS
                        let totalHours = parseFloat(columnValue);
                        let totalSeconds = Math.round(totalHours * 3600); // Convert hours to seconds

                        let hours = Math.floor(totalSeconds / 3600);
                        totalSeconds %= 3600;
                        let minutes = Math.floor(totalSeconds / 60);
                        let seconds = totalSeconds % 60;

                        // Padding with '0' if necessary
                        hours = String(hours).padStart(2, '0');
                        minutes = String(minutes).padStart(2, '0');
                        seconds = String(seconds).padStart(2, '0');

                        // Constructing timer display with separate tags for hours, minutes, and seconds
                        const $hoursSpan = $('<span>').addClass('tag timer').css({'background-color': 'green'}).text(hours);
                        const $minutesSpan = $('<span>').addClass('tag timer').css({'background-color': 'green'}).text(minutes);
                        const $secondsSpan = $('<span>').addClass('tag timer').css({'background-color': 'green'}).text(seconds);

                        const $timeContainer = $('<td>');
                        $timeContainer.append($hoursSpan)
                                    .append(document.createTextNode(':'))
                                    .append($minutesSpan)
                                    .append(document.createTextNode(':'))
                                    .append($secondsSpan);

                        const row = $('<tr>').append($('<td>').text(columnName)).append($timeContainer);
                        detailsTable.append(row);
                    } else {
                        const row = $('<tr>').append($('<td>').text(columnName)).append($('<td>').text(columnValue));
                        detailsTable.append(row);
                    }

                });

                $('.setup-step-button').prop('disabled', true);
                
                $('.next-btn').prop('disabled', false).off('click').on('click', function() {
                    callback(rowIndex);
                });

                $('.toggle-button').click(function() {
                    // Remove 'active' class from all buttons and hide all iPhones
                    $('.toggle-button').removeClass('active');
                    $('.iphone').hide();

                    // Add 'active' class to the clicked button and show corresponding iPhone
                    $(this).addClass('active');
                    var containerId = this.id.replace('toggle-', '') + '-container';
                    $('#' + containerId + ' .iphone').show();
                });

                // Show the form
                detailsForm.show();

                // Trigger click on the first button to show iPhone 13 by default
                $('#toggle-iphone13').click();

                callback(rowIndex);
                
            }

            function copyToClipboard(text) {
                navigator.clipboard.writeText(text).then(() => {
                    console.log('Text copied to clipboard');
                }).catch(err => {
                    console.error('Failed to copy text to clipboard', err);
                });
            }

            function fillHashKey(hash_key) {
                if(hash_key.length !== 6) {
                    console.error("hash_key must be exactly 6 characters long.");
                    return;
                }

                var inputs = $('.code-container input');
                for(var i = 0; i < hash_key.length; i++) {
                    inputs.eq(i).val(hash_key[i]);
                }
            }

            function updatePageHash(hashStr) {
                window.location.hash = hashStr;
            }

            function isUserRegistered() {
                var userId = localStorage.getItem(prefix_local_store('user_id'));
                return userId ? true : false;
            }

            function isUserLoggedIn() {
                var userId = localStorage.getItem(prefix_local_store('user_id'));
                var sessionToken = localStorage.getItem(prefix_local_store('session_token'));
                return userId && sessionToken ? true : false;
            }

            function isTaskHashKeyGenerated(taskId) {
                var hash_key = localStorage.getItem(prefix_local_store(`TASK_ID__${taskId}__hash_key`));
                return hash_key ? true : false;
            }

            function checkUserSession() {
                var userId = localStorage.getItem(prefix_local_store('user_id'));
                var sessionToken = localStorage.getItem(prefix_local_store('session_token'));

                if (!userId) {
                    showModal('Please register to start on this challenge.');
                    return false;
                } else if (!sessionToken) {
                    showModal('Please login to continue.');
                    return false;
                }

                return true;
            }

            function showModal(message) {
                $('#modal-message').text(message);
    
                var modal = $('#user-modal');
                var windowWidth = $(window).width();
                var windowHeight = $(window).height();
                var modalWidth = modal.outerWidth();
                var modalHeight = modal.outerHeight();

                // Calculating the top and left offset to center the modal
                var top = Math.max(windowHeight / 2 - modalHeight / 2, 0);
                var left = Math.max(windowWidth / 2 - modalWidth / 2, 0);

                modal.css({
                    top: top + $(window).scrollTop(),
                    left: left + $(window).scrollLeft(),
                    position: 'absolute'
                });

                modal.show();
            }            

            function showModalPanel(evtTgt, message, panelPosition = "left") {
                var $modalText = $('#modal-message');
                $modalText.text(message);

                var $modal = $('#user-modal');
                $modal.show();

                var targetPosition = $(evtTgt).offset(); // Using offset() to consider the document's top and left
                var targetHeight = $(evtTgt).outerHeight(); // Height of the clicked element
                var targetWidth = $(evtTgt).outerWidth(); // Width of the clicked element

                var top = targetPosition.top + targetHeight;
                var left = 0;

                switch (panelPosition) {
                    case "center":
                        left = targetPosition.left + targetWidth / 2 - ($modal.innerWidth() / 2);
                        break;
                    case "left":
                        left = targetPosition.left - $modal.innerWidth();
                        break;
                    case "right":
                        left = targetPosition.left + $modal.innerWidth();
                        break;
                }
                
                $modal.css({
                    "top": top, // Position above evtTgt
                    "left": left, // Adjust for horizontal scroll
                    "position": "absolute", // Ensure the modal is positioned absolutely
                    "display": "block"
                });
            }

            function showRegisterPanel(evtTgt, panelPosition = "left") {
                var $registerModal = $('#register-modal');
                $registerModal.show();

                var targetPosition = $(evtTgt).offset(); // Using offset() to consider the document's top and left
                var targetHeight = $(evtTgt).outerHeight(); // Height of the clicked element
                var targetWidth = $(evtTgt).outerWidth(); // Width of the clicked element

                var top = targetPosition.top + targetHeight;
                var left = 0;

                switch (panelPosition) {
                    case "center":
                        left = targetPosition.left + targetWidth / 2 - ($registerModal.innerWidth() / 2);
                        break;
                    case "left":
                        left = targetPosition.left - $registerModal.innerWidth();
                        break;
                    case "right":
                        left = targetPosition.left + $registerModal.innerWidth();
                        break;
                }
                
                $registerModal.css({
                    "top": top, // Position above evtTgt
                    "left": left, // Adjust for horizontal scroll
                    "position": "absolute", // Ensure the modal is positioned absolutely
                    "display": "block"
                });

                // Event listener for email input on register modal
                $("#register-modal input[name='email']").on('input', function() {
                    toggleVerificationButton("#register-modal input[name='email']", "#register_button");
                });

                // Initialize verification buttons as disabled
                $('#register_button').prop('disabled', true);

                $('#register-modal-input').off('keydown').on('keydown', function(event) {
                    if (event.keyCode === 13) { // 13 is the key code for Enter
                        event.preventDefault();
                        generateVerificationCode(evtTgt, "register");
                    }
                });

                // Bind the showVerificationModal to the click event of the button
                $('#register_button').click(function() {
                    generateVerificationCode(evtTgt, "register");
                });                

                toggleVerificationButton("#register-modal input[name='email']", "#register_button");
            }

            function showLoginPanel(evtTgt, panelPosition = "left") {
                var $loginModal = $('#login-modal');
                $loginModal.show();

                var targetPosition = $(evtTgt).offset(); // Using offset() to consider the document's top and left
                var targetHeight = $(evtTgt).outerHeight(); // Height of the clicked element
                var targetWidth = $(evtTgt).outerWidth(); // Width of the clicked element

                var top = targetPosition.top + targetHeight;
                var left = 0;

                switch (panelPosition) {
                    case "center":
                        left = targetPosition.left + targetWidth / 2 - ($loginModal.innerWidth() / 2);
                        break;
                    case "left":
                        left = targetPosition.left - $loginModal.innerWidth();
                        break;
                    case "right":
                        left = targetPosition.left + $loginModal.innerWidth();
                        break;
                }
                
                $loginModal.css({
                    "top": top, // Position above evtTgt
                    "left": left, // Adjust for horizontal scroll
                    "position": "absolute", // Ensure the modal is positioned absolutely
                    "display": "block"
                });

                // Event listener for email input on login modal
                $("#login-modal input[name='email']").on('input', function() {
                    toggleVerificationButton("#login-modal input[name='email']", "#login_button");
                });

                $('#login_button').prop('disabled', true);                 

                $('#login-modal-input').off('keydown').on('keydown', function(event) {
                    if (event.keyCode === 13) { // 13 is the key code for Enter
                        event.preventDefault();
                        generateVerificationCode(evtTgt, "login");
                    }
                });

                $('#login_button').click(function() {
                    generateVerificationCode(evtTgt, "login");
                });

                toggleVerificationButton("#login-modal input[name='email']", "#login_button");
            }

            // Close modal when the close button is clicked
            $('.close-btn').on('click', function() {
                $('#user-modal').hide();
            });

            // Get the register modal
            var registerModal = document.getElementById('register-modal');

            // Get the button that opens the modal
            var registerButton = document.getElementById('register-btn');

            // Get the <span> element that closes the modal
            var registerClose = document.getElementById('register_close');

            // When the user clicks the button, open the modal 
            registerButton.onclick = function() {
                showRegisterPanel(registerButton);                
            }

            // When the user clicks on <span> (x), close the modal
            registerClose.onclick = function() {
                registerModal.style.display = 'none';
            }

            // Get the login modal
            var loginModal = document.getElementById('login-modal');

            // Get the button that opens the modal
            var loginButton = document.getElementById('login-btn');

            // Get the <span> element that closes the modal
            var loginClose = document.getElementById('login_close');

            // When the user clicks the button, open the modal 
            loginButton.onclick = function() {
                showLoginPanel(loginButton);                
            }

            // When the user clicks on <span> (x), close the modal
            loginClose.onclick = function() {
                loginModal.style.display = 'none';
            }

            // When the user clicks anywhere outside of the register modal, close it
            window.onclick = function(event) {
                if (event.target == registerModal) {
                    registerModal.style.display = 'none';
                }
                else if (event.target == loginModal) {
                    loginModal.style.display = 'none';
                }
                else if (event.target.className === "modal") {
                    $(event.target).hide();
                }
            }

            // Get the login modal
            var verificationModal = document.getElementById('verification-modal');

            // Get the <span> element that closes the login modal
            var verificationClose = document.getElementById('verification_close');

            // When the user clicks on <span> (x), close the register modal
            verificationClose.onclick = function() {
                verificationModal.style.display = 'none';
            }

            function authUser(email, otp, modalType) {
                // Show spinner
                $(`#${modalType}-spinner`).show();

                // Define a timeout duration
                var timeoutDuration = 10000;

                // Set up a timer for the timeout
                var timeout = setTimeout(function() {
                    // Hide spinner
                    $(`#${modalType}-spinner`).hide();
                    // Show timeout error message
                    $(`#${modalType}-error`).text('Verify timed out. Support email: support@bettr.casino.').show();
                }, timeoutDuration);

                var createUser = modalType === "register" ? true : false;

                // Make the HTTP POST request
                $.ajax({
                    url: 'https://gateway.snapser.com/xbeovm9i/v1/auth/login/email',
                    type: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify({ "email": email, 'otp': otp, 'create_user': createUser }),
                    success: function(response) {
                        // Clear the timeout
                        clearTimeout(timeout);
                        // Hide spinner and error message
                        $(`#verification-spinner`).hide();
                        $(`#verification-error`).hide();
                        // Store the user id and session token in local storage
                        var user = response.user;
                        var userId = user.id;
                        var sessionToken = user.session_token;
                        var isBanned = user.is_banned;
                        var isVerified = user.is_verified;
                        if (isBanned) {
                            $(`#verification-error`).text('Your account is currently banned. If this persists, email support@bettr.casino.');
                        } else if (!isVerified) {
                            $(`#verification-error`).text('Your account is currently not verified using the email verification code. Support email: support@bettr.casino.');
                        } else {
                            $(`#verification-error`).hide();
                            $(`#verification-modal`).hide();
                            localStorage.setItem(prefix_local_store('user_id'), userId);
                            localStorage.setItem(prefix_local_store('session_token'), sessionToken);
                            $('#register-btn').hide();
                            $('#login-btn').hide();
                            $('#logout-btn').show();
                            authObserverManager.notify({});
                        }
                    },
                    error: function(xhr, status, error) {
                        // Clear the timeout
                        clearTimeout(timeout);
                        // Hide spinner and show error message
                        $(`#verification-spinner`).hide();
                        $(`#verification-error`).text(`Verify error. If this persists, email support@bettr.casino.`).show();
                    }
                });
            }

            // Function to show the verification modal
            function showVerificationPanel(evtTgt, email, modalType, panelPosition = "center") {
                // Get the register modal
                var parentModal = $(`#${modalType}-modal`);
                parentModal.hide();

                var $verificationModal = $('#verification-modal');
                $verificationModal.show();

                var targetPosition = $(evtTgt).offset(); // Using offset() to consider the document's top and left
                var targetHeight = $(evtTgt).outerHeight(); // Height of the clicked element
                var targetWidth = $(evtTgt).outerWidth(); // Width of the clicked element

                var top = targetPosition.top + targetHeight;
                var left = 0;

                switch (panelPosition) {
                    case "center":
                        left = targetPosition.left + targetWidth / 2 - ($verificationModal.innerWidth() / 2);
                        break;
                    case "left":
                        left = targetPosition.left - $verificationModal.innerWidth();
                        break;
                    case "right":
                        left = targetPosition.left + $verificationModal.innerWidth();
                        break;
                }
                
                $verificationModal.css({
                    "top": top, // Position above evtTgt
                    "left": left, // Adjust for horizontal scroll
                    "position": "absolute", // Ensure the modal is positioned absolutely
                    "display": "block"
                });

                var modalHeader = $("#verification-modal .verification-modal-content h2");
                var modalBackButton = $("#verification_back");
                modalHeader.text(modalType === "register" ? "Register" : "Login");

                // Set the event handler for the back button
                modalBackButton.on("click", function() {
                    $('#verification-modal').hide();
                    $("#" + modalType + "-modal").show();
                });

                // Get the button that opens the login or register modal
                var btn = document.getElementById(`${modalType}-btn`);
                var rect = btn.getBoundingClientRect();

                $('#verification_button').click(function() {
                    var otp = $("#verification-form input[name='verification_code']").val();
                    authUser(email, otp, modalType);
                });

                $('#verification-modal-input').off('keydown').on('keydown', function(event) {
                    if (event.keyCode === 13) {
                        event.preventDefault();
                        var otp = $("#verification-form input[name='verification_code']").val();
                        authUser(email, otp, modalType);
                    }
                });

            }

            function generateVerificationCode(evtTgt, modalType) {
                var email = $(`#${modalType}-modal input[name='email']`).val();
                // Show spinner
                $(`#${modalType}-spinner`).show();

                // Define a timeout duration
                var timeoutDuration = 10000;

                // Set up a timer for the timeout
                var timeout = setTimeout(function() {
                    // Hide spinner
                    $(`#${modalType}-spinner`).hide();
                    // Show timeout error message
                    $(`#${modalType}-error`).text('Verification code request timed out. If this persists, email support@bettr.casino.').show();
                }, timeoutDuration);

                // Make the HTTP POST request
                $.ajax({
                    url: 'https://gateway.snapser.com/xbeovm9i/v1/auth/otp',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ "email": email }),
                    success: function(response) {
                        // Clear the timeout
                        clearTimeout(timeout);
                        // Hide spinner and error message
                        $(`#${modalType}-spinner`).hide();
                        $(`#${modalType}-error`).hide();
                        // Call showVerificationModal on success
                        showVerificationPanel(evtTgt, email, modalType);
                    },
                    error: function(xhr, status, error) {
                        // Clear the timeout
                        clearTimeout(timeout);
                        // Hide spinner and show error message
                        $(`#${modalType}-spinner`).hide();
                        $(`#${modalType}-error').text('Verification code request error. If this persists, email support@bettr.casino.`).show();
                    }
                });
            }

            // Function to refresh the session token
            function validateSessionToken(callback) {
                var userId = localStorage.getItem(prefix_local_store('user_id'));
                var sessionToken = localStorage.getItem(prefix_local_store('session_token'));

                if (!sessionToken)
                {
                    $('#login-btn').show();
                    $('#logout-btn').hide();
                    return;
                }

                if (userId && sessionToken) {
                    $.ajax({
                        url: 'https://gateway.snapser.com/xbeovm9i/v1/auth/validate',
                        type: 'POST',
                        contentType: 'application/json',
                        headers: { 'Token': sessionToken },
                        data: JSON.stringify({ "session_token": sessionToken }),
                        success: function(response) {
                            console.log(response);
                            var user = response.user;
                            $('#login-btn').hide();
                            $('#logout-btn').show();
                            callback(null, response);
                        },
                        error: function(xhr, status, error) {
                            // Handle error (optional)
                            console.error(error);
                            alert(error);
                            localStorage.removeItem(prefix_local_store('session_token'));
                            $('#login-btn').show();
                            $('#logout-btn').hide();
                            callback(error, null);
                        }
                    });
                }
            }

            function initializeDeveloperAccount(taskId, taskState, callback) {
                var userId = localStorage.getItem(prefix_local_store('user_id'));
                var sessionToken = localStorage.getItem(prefix_local_store('session_token'));
                console.log('userId=', userId, 'sessionToken=', sessionToken);
                $.ajax({
                    url: 'https://zgtla52nt3w5vyh6jhh6e4js6y0qbgji.lambda-url.us-west-2.on.aws/',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        "user_id": userId,
                        "session_token": sessionToken,
                        "task_id": taskId,
                        "task_state": taskState
                    }),
                    success: function(response) {
                        console.log("Response received: ", JSON.stringify(response));
                        callback(response, null);
                    },
                    error: function(xhr, status, error) {
                        console.error("Error in invoking Lambda:", error);
                        callback(null, error);
                    }
                });
            }

            function wrapSuccessMessage(message) {
                return '<span style="color: #9a9af7;">' + message + '</span>';
            }

            function updateTaskState(blob, task_id, task_state, callback) {
                if (!blob) {
                    console.error('No blob found');
                    callback(null, new Error('No blob found'));
                    return;
                }
                let tasks = blob.tasks;
                if (!tasks) {
                    console.error('No tasks found in blob');
                    callback(null, new Error('No tasks found in blob'));
                    return;
                }
                // Search for the task and change its state to 'started'
                let task = tasks.find(t => t.task_id === task_id);
                if (!task) {
                    console.error(`No task found with task_id=${task_id}`);
                    callback(null, new Error(`No task found with task_id=${task_id}`));
                    return
                }
                task.state = task_state;
                console.log('local updated developer blob=', blob);
                callback(blob, null);
            }

            function updateDeveloperAccount(user_id, session_token, blob, cas, callback) {
                const url = `https://gateway.snapser.com/xbeovm9i/v1/storage/owner/${user_id}/protected/blobs/developer`;
                $.ajax({
                    url: url,
                    type: 'PUT',
                    contentType: 'application/json',
                    headers: { 'Token': session_token },
                    data: JSON.stringify({
                        value: JSON.stringify(blob),
                        create: false,
                        cas: cas
                    }),
                    success: function(putResponse) {
                        console.log('PUT success: putResponse=', putResponse);
                        callback(putResponse, null);
                    },
                    error: function(xhr, status, putError) {
                        console.error('PUT error:', putError);
                        callback(null, putError);
                    }
                });
            }

            function getDeveloperAccount(user_id, session_token, callback) {                
                const url = `https://gateway.snapser.com/xbeovm9i/v1/storage/owner/${user_id}/protected/blobs/developer`;

                $.ajax({
                    url: url,
                    type: 'GET',
                    headers: { 'Token': session_token },
                    success: function(data) {
                        console.log('Fetch success:', data);
                        callback(data, null);
                    },
                    error: function(xhr, status, error) {
                        console.error('Fetch error:', error);
                        callback(null, error);
                    }
                });
            }
            
            function wrapErrorMessage(message) {
                return '<span style="color: #f79a9a;">' + message + '</span>';
            }

            function findKeysWithPrefix(prefix) {
                const keysWithPrefix = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith(prefix)) {
                        keysWithPrefix.push(key);
                    }
                }
                return keysWithPrefix;
            }

            function startCountdown(duration, display) {
                var timer = duration, seconds;
                var countdownInterval = setInterval(function () {
                    seconds = parseInt(timer % 60, 10);

                    seconds = seconds < 10 ? "0" + seconds : seconds;

                    display.val(seconds);

                    if (--timer < 0) {
                        clearInterval(countdownInterval);
                    }
                }, 1000);
            }

            function initiateVerifySetupCountdown(duration) {
                display = $('#setupCountdownTimer');
                startCountdown(duration, display);
            }

            function initiateVerifyUnitySetupCountdown(duration) {
                display = $('#unitySetupCountdownTimer');
                startCountdown(duration, display);
            }

            function initiateVerifyAppCountdown(duration) {
                display = $('#countdownTimer');
                startCountdown(duration, display);
            }

            function verifyAppInstall(objectKey, maxRetries, callback) {
                let retries = 0;
                const retryInterval = 3000; // Retry every 3 seconds

                function attemptFetch() {
                    getState(objectKey, function(response, status, error) {
                        if (error == null) {
                            if (response.file_data) {
                                const imgElement = $('<img>').attr('src', 'data:image/png;base64,' + response.file_data);
                                activeIPhoneContainer().empty().append(imgElement);
                                callback(null);
                            } else {
                                console.error("Image data not found in response");
                                callback(new Error('Image data not found'));
                            }
                        } else {
                            if (status === 404) {
                                retries++;
                                if (retries < maxRetries) {
                                    setTimeout(attemptFetch, retryInterval);
                                } else {
                                    console.error(`getState error=${error}`);
                                    const errorMessage = "Verify failed.";
                                    callback(new Error(errorMessage));
                                }
                            } else {
                                console.error("Error in invoking Lambda:", error);
                                callback(null, error);
                            }
                        }
                    });                
                }

                attemptFetch();
            }

            function getState(objectKey, callback) {
                $.ajax({
                    url: 'https://acqgvpocrqiy6t6v7wfdhku2ae0bmfka.lambda-url.us-west-2.on.aws/',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({
                        "object_key": objectKey
                    }),
                    success: function(response) {
                        console.log(`Response received: objectKey=${objectKey} response=${JSON.stringify(response)}`);
                        callback(response, 200, null);
                    },
                    error: function(xhr, status, error) {
                        console.log(`Response received: xhr.status=${xhr.status} objectKey=${objectKey} response=${JSON.stringify(error)}`);
                        callback(null, status, error);
                    }
                });
            }

            function parseExpression(expr, context) {
                // Tokenize the expression, including curly braces
                const tokens = expr.match(/\w+|AND|OR|\{|\}/g);

                // Recursive function to evaluate the expression
                function evaluate(tokens) {
                    let stack = [];

                    while (tokens.length > 0) {
                        const token = tokens.shift();

                        if (token === 'AND' || token === 'OR') {
                            const right = stack.pop();
                            const left = stack.pop();
                            const result = (token === 'AND') ? (left && right) : (left || right);
                            stack.push(result);
                        } else if (token === '{') {
                            // Handle curly brace as grouping
                            let subExpr = [];
                            let openBraces = 1;
                            while (openBraces > 0) {
                                const nextToken = tokens.shift();
                                if (nextToken === '{') {
                                    openBraces++;
                                } else if (nextToken === '}') {
                                    openBraces--;
                                }
                                if (openBraces > 0) {
                                    subExpr.push(nextToken);
                                }
                            }
                            stack.push(evaluate(subExpr));
                        } else {
                            // Assume token is a variable and evaluate its value
                            stack.push(context[token]);
                        }
                    }

                    return stack.pop();
                }

                return evaluate(tokens);
            }

            // Event handlers for closing the modals
            $(".close-btn").click(function() {
                $(this).closest(".modal").hide();
            });

            // Logout button click event
            $('#logout-btn').click(function() {
                // Clear local storage
                localStorage.removeItem(prefix_local_store('session_token'));
                findKeysWithPrefix(prefix_local_store('TASK_ID__')).forEach(key => localStorage.removeItem(key));

                // Hide Logout button and show Register and Login buttons
                $('#login-btn').show();
                $('#register-btn').show();
                $('#logout-btn').hide();
            });

            updateSignInButtons();

        });
    </script>

    <footer>
        <p>&copy; 2024 Bettr Casino</p>
    </footer>

</body>
</html>
